

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Actions &mdash; Kervi 0.15.0 - beta documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Camera and video" href="camera.html" />
    <link rel="prev" title="Signal handling" href="signals.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Kervi
          

          
          </a>

          
            
            
              <div class="version">
                0.15.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstarted/index.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="signals.html">Signal handling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Actions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#define-actions">Define actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actions-with-timeout">Actions with timeout</a></li>
<li class="toctree-l2"><a class="reference internal" href="#asynchronous-action-call">Asynchronous action call</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interrupts">Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linking-to-dashboards">Linking to dashboards</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linking-to-values">Linking to values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-actions">System actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complete-example">Complete example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-process">Multi process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Camera and video</a></li>
<li class="toctree-l1"><a class="reference internal" href="motors.html">Motors</a></li>
<li class="toctree-l1"><a class="reference internal" href="display.html">Displays</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="hal.html">Hardware and devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="devices/index.html">Device library</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_process.html">Process distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">Distributed applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="messaging.html">Messaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="service.html">Run as service</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Commandline tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipc.html">Interprocess communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="kervi_api.html">Kervi API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Kervi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Actions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>Actions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>Actions are distributed functions that may be called from anywhere in your kervi application.
The framework handles process and network boundaries for you if your application
is a kervi multiprocess/multi device application and/or uses kervi modules.</p>
<div class="section" id="define-actions">
<h2>Define actions<a class="headerlink" href="#define-actions" title="Permalink to this headline">¶</a></h2>
<p>You turn a function into an action via the &#64;action decorator</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span>

<span class="nd">@action</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my action&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>You are now able to call it from anywhere in your application via:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">Actions</span>

<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;my_action&quot;</span><span class="p">](</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The &#64;action decorator takes the optional parameters action_id.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">action_id</span><span class="o">=</span><span class="s2">&quot;alternative_id&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my action&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>You now call it via:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">Actions</span>

<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;alternative_id&quot;</span><span class="p">](</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You may also decorate methods in kervi controllers:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.controllers.controller</span> <span class="k">import</span> <span class="n">controller</span>
<span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span>

<span class="k">class</span> <span class="nc">GateController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_id</span><span class="o">=</span><span class="s2">&quot;gate_controller&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Gate controller&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="nd">@action</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;open gate with speed:&quot;</span><span class="p">,</span> <span class="n">speed</span><span class="p">)</span>
</pre></div>
</div>
<p>And call the action</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">Actions</span>

<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;gate_controller.open&quot;</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="actions-with-timeout">
<h2>Actions with timeout<a class="headerlink" href="#actions-with-timeout" title="Permalink to this headline">¶</a></h2>
<p>By default, an action is called synchronous and first returns with the result when the action is completed.
If you expect your action to operate within a special time interval, you can add the keyword parameter timeout to
the action call. If the execution time exceeds the timeout, a TimeoutError exception is raised.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@action</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;started&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">my_action</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Timout occured&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the action is defined in another process or module call this way:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;my_action&quot;</span><span class="p">](</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TimeoutError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time out in action&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="asynchronous-action-call">
<h2>Asynchronous action call<a class="headerlink" href="#asynchronous-action-call" title="Permalink to this headline">¶</a></h2>
<p>It is possible to call an action asynchronously if you don’t want to wait for the action to finish execution.
Just set the keyword argument run_async to true.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;my_action&quot;</span><span class="p">](</span><span class="n">run_async</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="interrupts">
<h2>Interrupts<a class="headerlink" href="#interrupts" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you need to signal a running action during execution.
To handle this situation you need to specify an interrupt function for an action.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">terminate</span> <span class="o">=</span> <span class="kc">False</span>
<span class="nd">@action</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my_action start&quot;</span><span class="p">)</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">terminate</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my_action done&quot;</span><span class="p">)</span>

<span class="nd">@my_action</span><span class="o">.</span><span class="n">set_interrupt</span>
<span class="k">def</span> <span class="nf">my_action_interrupt</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">terminate</span>
    <span class="n">terminate</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;interrupt my_action&quot;</span><span class="p">)</span>


<span class="c1">#call action</span>
<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;my_action&quot;</span><span class="p">]()</span>

<span class="c1">#wait for five seconds</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1">#signal that the action should terminate</span>
<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;my_action&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interrupt</span><span class="p">()</span>
</pre></div>
</div>
<p>Interrupts support parameters</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@my_action</span><span class="o">.</span><span class="n">set_interrupt</span>
<span class="k">def</span> <span class="nf">my_action_interrupt</span><span class="p">(</span><span class="n">p1</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">terminate</span>
    <span class="n">terminate</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;interrupt my_action:&quot;</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>

<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;my_action&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interrupt</span><span class="p">(</span><span class="s2">&quot;P 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="linking-to-dashboards">
<h2>Linking to dashboards<a class="headerlink" href="#linking-to-dashboards" title="Permalink to this headline">¶</a></h2>
<p>It is possible to link actions to ui dashboards in the same way as signals.
A linked action will show up as a button on the panel.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@action</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this is my action&quot;</span><span class="p">)</span>

<span class="n">my_action</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;gate&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can send parameters to the action.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;My action&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my_action is called with:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="n">my_action</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="n">action_parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>If an interrupt function is set for the action it will be called when the button is released.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;My action&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my_action is called with:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="nd">@my_action</span><span class="o">.</span><span class="n">set_interrupt</span>
<span class="k">def</span> <span class="nf">my_action_interrupt</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my_action interrupt called&quot;</span><span class="p">)</span>

<span class="n">my_action</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="n">action_parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>You are able to specify parameters that should be send in the interrupt.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span>

<span class="nd">@action</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;My action&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_action</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my_action is called with:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="nd">@my_action</span><span class="o">.</span><span class="n">set_interrupt</span>
<span class="k">def</span> <span class="nf">my_action_interrupt</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;my_action interrupt called: &quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="n">my_action</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="n">action_parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">interrupt_parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Other keyword parameters you can use in link_to_dashboard:</p>
<blockquote>
<div><ul class="simple">
<li><em>link_to_header</em> (<code class="docutils literal notranslate"><span class="pre">str</span></code>) – Link this action to the header of the panel.</li>
<li><em>label_icon</em> (<code class="docutils literal notranslate"><span class="pre">str</span></code>) – Icon that should be displayed together with label.</li>
<li><em>label</em> (<code class="docutils literal notranslate"><span class="pre">str</span></code>) – Label text, default value is the name of the action.</li>
<li><em>flat</em> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>) – Flat look and feel.</li>
<li><dl class="first docutils">
<dt><em>inline</em> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>) –</dt>
<dd>Display button and label in its actual size
If you set inline to true the size parameter is ignored.
The action will only occupy as much space as the label and input takes.</dd>
</dl>
</li>
<li><em>on_text</em> (<code class="docutils literal notranslate"><span class="pre">string</span></code>) – Text to display when switch is on.</li>
<li><em>off_text</em> (<code class="docutils literal notranslate"><span class="pre">string</span></code>) – Text to display when switch is off.</li>
<li><em>on_icon</em> (<code class="docutils literal notranslate"><span class="pre">string</span></code>) – Icon to display when switch is on.</li>
<li><em>off_icon</em> (<code class="docutils literal notranslate"><span class="pre">string</span></code>) – Icon to display when switch is off.</li>
<li><em>button_icon</em> (<code class="docutils literal notranslate"><span class="pre">string</span></code>) – Icon to display on button.</li>
<li><em>button_text</em> (<code class="docutils literal notranslate"><span class="pre">string</span></code>) – Text to display on button, default is name.</li>
<li><em>action_parameters</em> (<code class="docutils literal notranslate"><span class="pre">list</span></code>) – list of parameters to pass to the action.</li>
<li><em>interrupt_enabled</em> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>) – If true the button will send interrupt to action on off. Default true if an interrupt is specified for the action.</li>
<li><em>interrupt_parameters</em> (<code class="docutils literal notranslate"><span class="pre">list</span></code>) – List of parameters to pass to the interrupt function of the action.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="linking-to-values">
<h2>Linking to values<a class="headerlink" href="#linking-to-values" title="Permalink to this headline">¶</a></h2>
<p>It is possible to link an action to gpio or sensors or other kervi values.
When the value of linked source changes the Action is executed or interrupted.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_action</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">GPIO</span><span class="p">[</span><span class="s2">&quot;GPIO2&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>In the code above the action is linked to gpio2 if it goes high it executes the action.
When the gpio2 goes low the action is interrupted.</p>
<p>Here is another example where the action is linked to a sensors.
When the sensor value is 10 the action is executed.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_action</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span>
    <span class="n">temp_sensor</span><span class="p">,</span>
    <span class="n">trigger_value</span> <span class="o">=</span> <span class="mi">10</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You can also use an lambda expression as trigger.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_action</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span>
    <span class="n">temp_sensor</span><span class="p">,</span>
    <span class="n">trigger_value</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If you want to pass the value of the linked source you can do by setting the pass_value parameter
Now the action is called every time the source changes.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_action</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span>
    <span class="n">temp_sensor</span><span class="p">,</span>
    <span class="n">pass_value</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It is also possible to pass additional parameters to the action when it is triggered.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_action</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span>
    <span class="n">temp_sensor</span><span class="p">,</span>
    <span class="n">trigger_value</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">action_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You can also specify when the interrupt should fire.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_action</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span>
    <span class="n">temp_sensor</span><span class="p">,</span>
    <span class="n">trigger_value</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">action_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
    <span class="n">trigger_interrupt_value</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">interrupt_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="system-actions">
<h2>System actions<a class="headerlink" href="#system-actions" title="Permalink to this headline">¶</a></h2>
<p>When the kervi application has loaded and started all processes it calls the app_main action this is your hook where you can
start your application logic. In the same way app_exit action is called upon termination of the kervi application.</p>
<p>It is optional for you to define these actions in your application.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@action</span>
<span class="k">def</span> <span class="nf">app_main</span><span class="p">():</span>
    <span class="c1">#start your application logic here</span>


<span class="nd">@action</span>
<span class="k">def</span> <span class="nf">app_exit</span><span class="p">():</span>
    <span class="c1">#application logic that clean up and reset devices</span>
</pre></div>
</div>
<p>You can control the application via the following actions</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#stop the application</span>
<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;app.stop&quot;</span><span class="p">]</span>

<span class="c1">#restart the application</span>
<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;app.restart&quot;</span><span class="p">]</span>

<span class="c1">#shut down application device (Raspberry pi)</span>
<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;app.shutdown&quot;</span><span class="p">]</span>

<span class="c1">#reboot application device (Raspberry pi)</span>
<span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;app.reboot&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>You can connect a battery sensor to the <em>shutdown action</em> and initiate a shutdown of your device when the battery running low.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.application</span> <span class="k">import</span> <span class="n">Application</span>

    <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">kervi.sensors.sensor</span> <span class="k">import</span> <span class="n">Sensor</span>
    <span class="kn">from</span> <span class="nn">kervi.devices.sensors.CW2015</span> <span class="k">import</span> <span class="n">CW2015CapacityDeviceDriver</span>

    <span class="n">capacity_sensor</span> <span class="o">=</span> <span class="n">Sensor</span><span class="p">(</span><span class="s2">&quot;CW2015_capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;CW2015 capacity&quot;</span><span class="p">,</span> <span class="n">CW2015CapacityDeviceDriver</span><span class="p">())</span>

    <span class="c1">#link sensor to action.</span>
    <span class="n">APP</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">shutdown</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">capacity_sensor</span><span class="p">,</span> <span class="n">trigger_value</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1">#display a battery icon in the header of your application.</span>
    <span class="n">capacity_sensor</span><span class="o">.</span><span class="n">set_ui_parameter</span><span class="p">(</span><span class="s2">&quot;value_icon&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;range&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span><span class="s2">&quot;battery-empty&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;range&quot;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span><span class="s2">&quot;battery-quarter&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;range&quot;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span><span class="s2">&quot;battery-half&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;range&quot;</span><span class="p">:[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span><span class="s2">&quot;battery-three-quarters&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;range&quot;</span><span class="p">:[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span><span class="s2">&quot;battery-full&quot;</span>
        <span class="p">}</span>
    <span class="p">])</span>
    <span class="n">capacity_sensor</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;header_right&quot;</span><span class="p">,</span> <span class="n">display_unit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_sparkline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">APP</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">shutdown</span>
</pre></div>
</div>
</div>
<div class="section" id="complete-example">
<h2>Complete example<a class="headerlink" href="#complete-example" title="Permalink to this headline">¶</a></h2>
<p>This is a complete example that shows a gate controller that controls a motor and have two end stop switches.
The end stops are linked to GPIO2 and GPIO3.</p>
<p>There are to two actions move_gate and stop_gate these are linked to the “gate” panel on the app dashboard.
The move_gate action is also linked GPIO4 and GPIO5. When GPIO4 is triggered the gate opens and closes when gpio5 is triggered.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">from</span> <span class="nn">kervi.application</span> <span class="k">import</span> <span class="n">Application</span>

    <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">kervi.dashboards</span> <span class="k">import</span> <span class="n">Dashboard</span><span class="p">,</span> <span class="n">DashboardPanel</span>
    <span class="n">Dashboard</span><span class="p">(</span>
        <span class="s2">&quot;app&quot;</span><span class="p">,</span>
        <span class="s2">&quot;App&quot;</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Gate&quot;</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">is_default</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">Dashboard</span><span class="p">(</span>
        <span class="s2">&quot;settings&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Settings&quot;</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;200px&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Gate&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">kervi.controllers.controller</span> <span class="k">import</span> <span class="n">Controller</span>
    <span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span>
    <span class="kn">from</span> <span class="nn">kervi.values</span> <span class="k">import</span> <span class="n">NumberValue</span><span class="p">,</span> <span class="n">BooleanValue</span>

    <span class="k">class</span> <span class="nc">GateController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_id</span><span class="o">=</span><span class="s2">&quot;gate_controller&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Gate controller&quot;</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gate_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="s2">&quot;Gate speed&quot;</span><span class="p">,</span> <span class="n">NumberValue</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gate_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gate_speed</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gate_speed</span><span class="o">.</span><span class="n">persist_value</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lo_end_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;lo_end_stop&quot;</span><span class="p">,</span> <span class="s2">&quot;low end stop&quot;</span><span class="p">,</span> <span class="n">BooleanValue</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hi_end_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;hi_end_stop&quot;</span><span class="p">,</span> <span class="s2">&quot;High end stop&quot;</span><span class="p">,</span> <span class="n">BooleanValue</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gate_motor_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;gate_motor_speed&quot;</span><span class="p">,</span> <span class="s2">&quot;Gate motor speed&quot;</span><span class="p">,</span> <span class="n">NumberValue</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_move</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="nd">@action</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Move gate&quot;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">move_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">open</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;open gate&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_end_stop</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_move</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gate_motor_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_speed</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_move</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_end_stop</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gate_motor_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hi_end_stop</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gate open&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gate stopped&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;close gate:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo_end_stop</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_move</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gate_motor_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gate_speed</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop_move</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo_end_stop</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gate_motor_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lo_end_stop</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gate closed&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gate stopped&quot;</span><span class="p">)</span>

        <span class="nd">@move_gate</span><span class="o">.</span><span class="n">set_interrupt</span>
        <span class="k">def</span> <span class="nf">move_gate_interrupt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stop gate:&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stop_move</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">controller_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;gate controller is started&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gate_motor_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">input_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changed_input</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="n">gate_controller</span> <span class="o">=</span> <span class="n">GateController</span><span class="p">()</span>
    <span class="n">gate_controller</span><span class="o">.</span><span class="n">move_gate</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">button_text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">button_icon</span><span class="o">=</span><span class="s2">&quot;arrow-up&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action_parameters</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">],</span> <span class="p">)</span>
    <span class="n">gate_controller</span><span class="o">.</span><span class="n">move_gate</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;gate&quot;</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">button_text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">button_icon</span><span class="o">=</span><span class="s2">&quot;arrow-down&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action_parameters</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span>

    <span class="n">gate_controller</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="s2">&quot;gate&quot;</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">kervi.devices.motors.dummy_motor_driver</span> <span class="k">import</span> <span class="n">DummyMotorBoard</span>

    <span class="n">motor_board</span> <span class="o">=</span> <span class="n">DummyMotorBoard</span><span class="p">()</span>
    <span class="n">gate_controller</span><span class="o">.</span><span class="n">gate_motor_speed</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">motor_board</span><span class="o">.</span><span class="n">dc_motors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">speed</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">kervi.hal</span> <span class="k">import</span> <span class="n">GPIO</span>
    <span class="n">GPIO</span><span class="p">[</span><span class="s2">&quot;GPIO2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">define_as_input</span><span class="p">()</span>
    <span class="n">GPIO</span><span class="p">[</span><span class="s2">&quot;GPIO3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">define_as_input</span><span class="p">()</span>

    <span class="n">gate_controller</span><span class="o">.</span><span class="n">lo_end_stop</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">GPIO</span><span class="p">[</span><span class="s2">&quot;GPIO2&quot;</span><span class="p">])</span>
    <span class="n">gate_controller</span><span class="o">.</span><span class="n">hi_end_stop</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">GPIO</span><span class="p">[</span><span class="s2">&quot;GPIO3&quot;</span><span class="p">])</span>

    <span class="n">gate_controller</span><span class="o">.</span><span class="n">move_gate</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">GPIO</span><span class="p">[</span><span class="s2">&quot;GPIO4&quot;</span><span class="p">],</span> <span class="n">action_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">])</span>
    <span class="n">gate_controller</span><span class="o">.</span><span class="n">move_gate</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">GPIO</span><span class="p">[</span><span class="s2">&quot;GPIO5&quot;</span><span class="p">],</span> <span class="n">action_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">])</span>

    <span class="n">APP</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is an app with two dashboards “app” where the gate is controlled and “settings” where the speed
of the gate speed could be set.</p>
<a class="reference internal image-reference" href="_images/gate_controller.png"><img alt="_images/gate_controller.png" src="_images/gate_controller.png" style="width: 35%;" /></a>
<a class="reference internal image-reference" href="_images/gate_controller_settings.png"><img alt="_images/gate_controller_settings.png" src="_images/gate_controller_settings.png" style="width: 35%;" /></a>
</div>
<div class="section" id="multi-process">
<h2>Multi process<a class="headerlink" href="#multi-process" title="Permalink to this headline">¶</a></h2>
<p>This example shows how to set up at simple robot and control it via an external script of commands.</p>
<p>It consists of two scripts robot.py that should be executed on the robot
and a script robot_task.py that holds a series of actions that the robot should perform.</p>
<p>robot.py is a kervi application that you should execute on your Raspberry pi, when started it will show the ip address of the app this should be used in the robot_task.py script.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">kervi.application</span> <span class="k">import</span> <span class="n">Application</span>

    <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">kervi.controllers.steering</span> <span class="k">import</span> <span class="n">MotorSteering</span>
    <span class="kn">from</span> <span class="nn">kervi.devices.motors.dummy_motor_driver</span> <span class="k">import</span> <span class="n">DummyMotorBoard</span>

    <span class="n">motor_board</span> <span class="o">=</span> <span class="n">DummyMotorBoard</span><span class="p">()</span>
    <span class="n">steering</span> <span class="o">=</span> <span class="n">MotorSteering</span><span class="p">()</span>

    <span class="n">steering</span><span class="o">.</span><span class="n">left_speed</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">motor_board</span><span class="o">.</span><span class="n">dc_motors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">steering</span><span class="o">.</span><span class="n">right_speed</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">motor_board</span><span class="o">.</span><span class="n">dc_motors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@action</span>
    <span class="k">def</span> <span class="nf">app_exit</span><span class="p">():</span>
        <span class="n">steering</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p>The other python script robot_tasks.py is a kervi module that connects to the
kervi application in robot.py. You can run it on the robot itself or another computer
on your local network.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">kervi.module</span> <span class="k">import</span> <span class="n">Module</span>
    <span class="kn">from</span> <span class="nn">kervi.actions</span> <span class="k">import</span> <span class="n">action</span><span class="p">,</span> <span class="n">Actions</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">Module</span><span class="p">({</span>
        <span class="s2">&quot;network&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ipc_root_address&quot;</span><span class="p">:</span> <span class="s2">&quot;#Enter the ip that is displayed when running robot.py#&quot;</span>
        <span class="p">}</span>
    <span class="p">})</span>

    <span class="nd">@action</span>
    <span class="k">def</span> <span class="nf">module_main</span><span class="p">():</span>
        <span class="c1">#move for 5 seconds at 100% speed</span>
        <span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;steering.move&quot;</span><span class="p">](</span><span class="mi">100</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1">#turn right at 50% speed</span>
        <span class="n">Actions</span><span class="p">[</span><span class="s2">&quot;steering.rotate&quot;</span><span class="p">](</span><span class="mi">50</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

    <span class="n">module</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="camera.html" class="btn btn-neutral float-right" title="Camera and video" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="signals.html" class="btn btn-neutral" title="Signal handling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Tim Wentzlau.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.15.0 - beta',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>