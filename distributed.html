

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Distributed applications</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Run as service" href="service.html" />
    <link rel="prev" title="Process distribution" href="multi_process.html" />
<script type="text/javascript" src="https://www.PrivacyPolicies.com/cookie-consent/releases/3.0.0/cookie-consent.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Kervi
          

          
          </a>

          
            
            
              <div class="version">
                0.20.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstarted/index.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="signals.html">Signal handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Camera and video</a></li>
<li class="toctree-l1"><a class="reference internal" href="motors.html">Motors</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpio.html">GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="display.html">Displays</a></li>
<li class="toctree-l1"><a class="reference internal" href="messaging.html">Messaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="hal.html">Hardware and devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="devices/index.html">Device library</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_process.html">Process distribution</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Distributed applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#use-cases">Use cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main-application">Main application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-modules">Application modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-discovery">Application discovery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#discovery-configuration">Discovery configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connection-without-auto-discovery">Connection without auto discovery</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="service.html">Run as service</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Commandline tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipc.html">Interprocess communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="kervi_api.html">Kervi API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Kervi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Distributed applications</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="distributed-applications">
<h1>Distributed applications<a class="headerlink" href="#distributed-applications" title="Permalink to this headline">¶</a></h1>
<p>With the kervi framework it is possible to distribute your application across several computers.
One computer is the main computer where your kervi application run.
On the other computers you create kervi modules that connects to your main application.
The kervi web ui will update it self as the modules starts and stops.</p>
<div class="section" id="use-cases">
<h2>Use cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h2>
<p>You can use this capability to connect several rapsberry pi’s and let them work as one.
An example could be several connected raspberry pi cams that.</p>
</div>
<div class="section" id="main-application">
<h2>Main application<a class="headerlink" href="#main-application" title="Permalink to this headline">¶</a></h2>
<p>You create and run your main application as normal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">kervi.application</span> <span class="kn">import</span> <span class="n">Application</span>
    <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">kervi.sensors</span> <span class="kn">import</span> <span class="n">Sensor</span>
    <span class="kn">from</span> <span class="nn">kervi.devices.sensors.system</span> <span class="kn">import</span> <span class="n">CPULoadSensorDeviceDriver</span>

    <span class="n">SENSOR_1</span> <span class="o">=</span> <span class="n">Sensor</span><span class="p">(</span><span class="s2">&quot;app_CPULoadSensor&quot;</span><span class="p">,</span> <span class="s2">&quot;App CPU&quot;</span><span class="p">,</span> <span class="n">CPULoadSensorDeviceDriver</span><span class="p">())</span>
    <span class="n">SENSOR_1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">link_to_header</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">SENSOR_1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;chart&quot;</span><span class="p">)</span>

    <span class="n">APP</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">shutdown</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;header_right&quot;</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">button_text</span><span class="o">=</span><span class="s2">&quot;App shutdown&quot;</span><span class="p">)</span>

    <span class="n">APP</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Run the application and the result should look like this:</p>
<img alt="_images/distribution_app.png" src="_images/distribution_app.png" />
</div>
<div class="section" id="application-modules">
<h2>Application modules<a class="headerlink" href="#application-modules" title="Permalink to this headline">¶</a></h2>
<p>Kervi application modules works almost identical to applications.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">kervi.module</span> <span class="kn">import</span> <span class="n">Module</span>
    <span class="n">APP_MODULE</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">kervi.sensors</span> <span class="kn">import</span> <span class="n">Sensor</span>
    <span class="kn">from</span> <span class="nn">kervi.devices.sensors.system</span> <span class="kn">import</span> <span class="n">CPULoadSensorDeviceDriver</span>

    <span class="n">SENSOR_1</span> <span class="o">=</span> <span class="n">Sensor</span><span class="p">(</span><span class="s2">&quot;module_cpu_load&quot;</span><span class="p">,</span> <span class="s2">&quot;Module CPU&quot;</span><span class="p">,</span> <span class="n">CPULoadSensorDeviceDriver</span><span class="p">())</span>
    <span class="n">SENSOR_1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">link_to_header</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">SENSOR_1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;chart&quot;</span><span class="p">)</span>

    <span class="n">APP_MODULE</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">shutdown</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;header_right&quot;</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">button_text</span><span class="o">=</span><span class="s2">&quot;App shutdown&quot;</span><span class="p">)</span>

    <span class="n">APP_MODULE</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Run your module python script on another computer on your local network.
After a few seconds the web ui should update it self and showing your module sensor.</p>
<img alt="_images/distribution_module.png" src="_images/distribution_module.png" />
</div>
<div class="section" id="application-discovery">
<h2>Application discovery<a class="headerlink" href="#application-discovery" title="Permalink to this headline">¶</a></h2>
<p>I the example above, the module is able to discover the application via the
build in app discovery capabilities of kervi.</p>
<p>When the app start it will listen to discovery requests from modules broadcasted on port 9434 (configurable).
The discovery broadcast includes the app id. The default id for kervi app is <em>kervi</em>, but you can change it via configuration.</p>
<p>For the app:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">({</span>
    <span class="s2">&quot;application&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;my_app_id&quot;</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>In the module configuration you enter the same id as in your application:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">APP</span> <span class="o">=</span> <span class="n">Module</span><span class="p">({</span>
    <span class="s2">&quot;application&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;my_app_id&quot;</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="section" id="discovery-configuration">
<h3>Discovery configuration<a class="headerlink" href="#discovery-configuration" title="Permalink to this headline">¶</a></h3>
<p>You are able to disable app discovery and change port via the discovery settings in configuration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">({</span>
    <span class="s2">&quot;application&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;my_app_id&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;discovery&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">9999</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>If you change the port you must do as well in the module config.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">APP</span> <span class="o">=</span> <span class="n">Module</span><span class="p">({</span>
    <span class="s2">&quot;application&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;my_app_id&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;discovery&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">9999</span>
    <span class="p">},</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="connection-without-auto-discovery">
<h3>Connection without auto discovery<a class="headerlink" href="#connection-without-auto-discovery" title="Permalink to this headline">¶</a></h3>
<p>If you want to connect modules without auto discovery you can enter the ip address and the ipc port that the module should use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">APP</span> <span class="o">=</span> <span class="n">Module</span><span class="p">({</span>
    <span class="s2">&quot;application&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;my_app_id&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;network&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ipc_root_port&quot;</span><span class="p">:</span> <span class="mi">9500</span><span class="p">,</span>
        <span class="s2">&quot;ipc_root_address&quot;</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mi">153</span>
    <span class="p">},</span>
<span class="p">})</span>
</pre></div>
</div>
<p>You can see address and port in the <em>IPC address</em> line when your application starts</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">no</span> <span class="n">config</span> <span class="nb">file</span> <span class="n">found</span><span class="p">,</span> <span class="n">revert</span> <span class="n">to</span> <span class="n">defaults</span>
<span class="n">Starting</span> <span class="n">kervi</span> <span class="n">application</span><span class="p">:</span> <span class="n">Kervi</span>
<span class="n">IPC</span> <span class="n">address</span><span class="p">:</span> <span class="n">tcp</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">0.153</span><span class="p">:</span><span class="mi">9500</span>
<span class="n">Using</span> <span class="n">HAL</span> <span class="n">driver</span><span class="p">:</span> <span class="n">kervi</span><span class="o">-</span><span class="n">hal</span><span class="o">-</span><span class="n">win</span>
<span class="n">start</span> <span class="n">storage</span> <span class="n">service</span>
<span class="n">load</span> <span class="n">interprocess</span> <span class="n">communication</span>
<span class="n">start</span> <span class="n">websocket</span><span class="p">:</span>  <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.153</span> <span class="mi">9000</span>
<span class="n">Listining</span> <span class="k">for</span> <span class="n">discovery</span> <span class="n">requests</span> <span class="n">on</span> <span class="n">port</span><span class="p">:</span> <span class="mi">9434</span>
<span class="n">Your</span> <span class="n">Kervi</span> <span class="n">application</span> <span class="ow">is</span> <span class="n">ready</span> <span class="n">at</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">0.153</span><span class="p">:</span><span class="mi">8080</span>
<span class="n">Press</span> <span class="n">ctrl</span> <span class="o">+</span> <span class="n">c</span> <span class="n">to</span> <span class="n">stop</span> <span class="n">your</span> <span class="n">application</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="service.html" class="btn btn-neutral float-right" title="Run as service" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="multi_process.html" class="btn btn-neutral float-left" title="Process distribution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Tim Wentzlau

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function () {
    cookieconsent.run({"notice_banner_type":"headline","consent_type":"express","palette":"dark","change_preferences_selector":"#changePreferences","language":"en"});
});
</script>

<script cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=UA-144183988-1"></script>
<script cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144183988-1');
</script>



</body>
</html>