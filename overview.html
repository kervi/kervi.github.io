

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overview &mdash; Kervi 0.8 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Kervi 0.8 documentation" href="index.html"/>
        <link rel="next" title="Dashboards" href="dashboards.html"/>
        <link rel="prev" title="Get started" href="getstarted.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Kervi
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Get started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#kervi-application-anatomy">Kervi application anatomy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#single-file-application">Single file application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#application-line-1-6">Application (line 1-6)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dashboards-line-7-13">Dashboards (line 7-13)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#camera-line-15-22">camera (line 15-22)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sensors-24-35">Sensors (24-35)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controllers-line-38-55">Controllers (line 38-55)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-the-engines-line-57">Start the engines (line 57)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#normal-application">Normal application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboards.html">Dashboards</a></li>
<li class="toctree-l1"><a class="reference internal" href="sensors.html">Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Camera and video</a></li>
<li class="toctree-l1"><a class="reference internal" href="hal.html">Hardware and devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipc.html">Component communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Commandline tool</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Kervi</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Overview</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>If you have completed the steps in the <em>Get started</em> section the result should be a running kervi application.
The application has a system dashboard that shows sensors messauring cpu, memory and disk use and a power controller.</p>
<div class="section" id="kervi-application-anatomy">
<h2>Kervi application anatomy<a class="headerlink" href="#kervi-application-anatomy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="single-file-application">
<h3>Single file application<a class="headerlink" href="#single-file-application" title="Permalink to this headline">¶</a></h3>
<p>Below you see the content of a <em>single file application</em> created with the commandline tool on a Raspberry Pi.</p>
<p>myapp.py</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
     <span class="kn">from</span> <span class="nn">kervi.bootstrap</span> <span class="kn">import</span> <span class="n">Application</span>
     <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>
     <span class="c1">#Important GPIO must be imported after application creation</span>
     <span class="kn">from</span> <span class="nn">kervi.hal</span> <span class="kn">import</span> <span class="n">GPIO</span>

     <span class="kn">from</span> <span class="nn">kervi.dashboard</span> <span class="kn">import</span> <span class="n">Dashboard</span><span class="p">,</span> <span class="n">DashboardPanel</span>
     <span class="n">DASHBOARD</span> <span class="o">=</span> <span class="n">Dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;App&quot;</span><span class="p">,</span> <span class="n">is_default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
     <span class="n">DASHBOARD</span><span class="o">.</span><span class="n">add_panel</span><span class="p">(</span><span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Light&quot;</span><span class="p">))</span>

     <span class="n">SYSTEMBOARD</span> <span class="o">=</span> <span class="n">Dashboard</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;System&quot;</span><span class="p">)</span>
     <span class="n">SYSTEMBOARD</span><span class="o">.</span><span class="n">add_panel</span><span class="p">(</span><span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
     <span class="n">SYSTEMBOARD</span><span class="o">.</span><span class="n">add_panel</span><span class="p">(</span><span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;cam&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

     <span class="c1">#Create a streaming camera server</span>
     <span class="kn">from</span> <span class="nn">kervi.camera</span> <span class="kn">import</span> <span class="n">CameraStreamer</span>
     <span class="n">CAMERA</span> <span class="o">=</span> <span class="n">CameraStreamer</span><span class="p">(</span><span class="s2">&quot;cam1&quot;</span><span class="p">,</span> <span class="s2">&quot;camera 1&quot;</span><span class="p">)</span>

     <span class="c1">#link camera as background</span>
     <span class="n">CAMERA</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">)</span>
     <span class="c1">#link camera to a panel</span>
     <span class="n">CAMERA</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;cam&quot;</span><span class="p">)</span>

     <span class="kn">from</span> <span class="nn">kervi.sensor</span> <span class="kn">import</span> <span class="n">Sensor</span>
     <span class="kn">from</span> <span class="nn">kervi_devices.platforms.common.sensors.cpu_use</span> <span class="kn">import</span> <span class="n">CPULoadSensorDeviceDriver</span>
     <span class="c1">#build in sensor that measures cpu use</span>
     <span class="n">SENSOR_1</span> <span class="o">=</span> <span class="n">Sensor</span><span class="p">(</span><span class="s2">&quot;CPULoadSensor&quot;</span><span class="p">,</span> <span class="s2">&quot;CPU&quot;</span><span class="p">,</span> <span class="n">CPULoadSensorDeviceDriver</span><span class="p">())</span>
     <span class="c1">#link to sys area top right</span>
     <span class="n">SENSOR_1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;sys-header&quot;</span><span class="p">)</span>
     <span class="c1">#link to a panel, show value in panel header and chart in panel body</span>
     <span class="n">SENSOR_1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">link_to_header</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
     <span class="n">SENSOR_1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;chart&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


     <span class="c1">#More on sensors https://kervi.github.io/sensors.html</span>


     <span class="c1">#define a light controller</span>
     <span class="kn">from</span> <span class="nn">kervi.controller</span> <span class="kn">import</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">UISwitchButtonControllerInput</span>
     <span class="k">class</span> <span class="nc">MyController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
         <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="n">Controller</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;lightController&quot;</span><span class="p">,</span> <span class="s2">&quot;Light&quot;</span><span class="p">)</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;light&quot;</span>

             <span class="c1">#define an input and link it to the dashboard panel</span>
             <span class="n">light1</span> <span class="o">=</span> <span class="n">UISwitchButtonControllerInput</span><span class="p">(</span><span class="s2">&quot;lightctrl.light1&quot;</span><span class="p">,</span> <span class="s2">&quot;Light&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
             <span class="n">light1</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="n">label_icon</span><span class="o">=</span><span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

             <span class="c1">#define GPIO</span>
             <span class="n">GPIO</span><span class="o">.</span><span class="n">define_as_output</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

         <span class="k">def</span> <span class="nf">input_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changed_input</span><span class="p">):</span>
             <span class="n">GPIO</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">changed_input</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

     <span class="n">MY_CONTROLLER</span> <span class="o">=</span> <span class="n">MyController</span><span class="p">()</span>

     <span class="n">APP</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="application-line-1-6">
<h4>Application (line 1-6)<a class="headerlink" href="#application-line-1-6" title="Permalink to this headline">¶</a></h4>
<p>The hart of a kervi application is the Application class.
You must create an Application instance as the very first
in your application.</p>
<p>The Application class prepares your application it figures out
if you are using a Raspberry Pi as your board and loads required
driveres. It also loads a web server that serves the files to the browser.</p>
</div>
<div class="section" id="dashboards-line-7-13">
<h4>Dashboards (line 7-13)<a class="headerlink" href="#dashboards-line-7-13" title="Permalink to this headline">¶</a></h4>
<p>Dashboards are as such not at part of your application logic but you need to
tell kervi how you want to organize your application in the browser.
You can have multiple dashboards in an application. It can be floores in a house
if your are developing a house automation project or it can be a camera view and
system information if you are creating a robot.</p>
<p>In the example above two dashboards are defined APP and SYSTEM.</p>
<p>Each dashboard has one or more panels where kervi components like sensors and controllers are linked to.</p>
</div>
<div class="section" id="camera-line-15-22">
<h4>camera (line 15-22)<a class="headerlink" href="#camera-line-15-22" title="Permalink to this headline">¶</a></h4>
<p>It is possible to stream your camera as a background on a dashboard or as content in a panel.
Use the method link_to_dashboard where you specify the dashboard and panel that should display the camera.
The camera will be displayed as a background if you omit the name of a panel in the call to link_to_dashboard.</p>
</div>
<div class="section" id="sensors-24-35">
<h4>Sensors (24-35)<a class="headerlink" href="#sensors-24-35" title="Permalink to this headline">¶</a></h4>
<p>Sensors are used to sence the world and readings from sensors are handled thru the Sensor Class.
You can program a sensor your self or you can utilize one of the ready made sensor drivers from the Kervi Device Library (KDL).</p>
<p>In the example above a <em>Cpu Load sensor</em> is fetched from KDL and applied to the Sensor class.
When the application is running the Sensor class polls <em>Cpu load sensor</em> device and notify other
parts of the application via events.</p>
<p>In order to display the values from the sensor in the browser you need to link it to a dashboard and a panel.
This is done by calling the method link_to_dashboard where you specify dashboard/panel and display parameters.
When a sensor is linked to a dashboard panel the UI logic will pick up sensor readings for the sensor and update the value on the screen.</p>
</div>
<div class="section" id="controllers-line-38-55">
<h4>Controllers (line 38-55)<a class="headerlink" href="#controllers-line-38-55" title="Permalink to this headline">¶</a></h4>
<p>Controllers react to input from user and input channels.
A custom controller inherits from the class Controller.
In __init__ ( the constructor) you define inputs and setup the hardware.</p>
<p>In the example above the controller defines a button and links it to a dashboard panel.
When the user pushes the button in the browser it will invoke the input_changed on the controller
and the controller will set the state on a output channel.</p>
</div>
<div class="section" id="start-the-engines-line-57">
<h4>Start the engines (line 57)<a class="headerlink" href="#start-the-engines-line-57" title="Permalink to this headline">¶</a></h4>
<p>The work so far have been to prepare your application nothing is running yet to actually launch your app you need to call APP.run().
This will launch the web server, interprocess communication systems and start sensor readings.</p>
</div>
</div>
<div class="section" id="normal-application">
<h3>Normal application<a class="headerlink" href="#normal-application" title="Permalink to this headline">¶</a></h3>
<p>Below is the structure of a multi file Kervi application. All the parts from a single file application are moved into
seperate files and foldes. Kervi uses this structure to load each section in its own process in order to improve the performance.</p>
<p>A second advantance to this model is that it is easier to maintain as the Kervi project grows bigger.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="n">root</span>
<span class="o">|</span>
<span class="o">|-</span> <span class="n">cams</span>
    <span class="o">|-</span> <span class="fm">__init__</span>
    <span class="o">|-</span> <span class="n">cam1</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">controllers</span>
    <span class="o">|-</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">my_controller</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">system_controller</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">dashboards</span>
    <span class="o">|-</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">sensors</span>
    <span class="o">|-</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">my_sensor</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">system_sensor</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">myapp</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The kervi application is bootstrapped in myapp.py</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.bootstrap</span> <span class="k">import</span> <span class="n">Application</span>
<span class="kn">import</span> <span class="nn">kervi.utility.nethelper</span> <span class="k">as</span> <span class="nn">nethelper</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">({</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;myapp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;My app&quot;</span><span class="p">,</span>
            <span class="s2">&quot;appKey&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;network&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;IPAddress&quot;</span><span class="p">:</span> <span class="n">nethelper</span><span class="o">.</span><span class="n">get_ip_address</span><span class="p">(),</span>
            <span class="s2">&quot;IPCBasePort&quot;</span><span class="p">:</span><span class="mi">9500</span><span class="p">,</span>
            <span class="s2">&quot;WebSocketPort&quot;</span><span class="p">:</span><span class="mi">9000</span><span class="p">,</span>
            <span class="s2">&quot;WebPort&quot;</span><span class="p">:</span> <span class="mi">8080</span><span class="p">,</span>
            <span class="s2">&quot;IPCSecret&quot;</span><span class="p">:</span><span class="sa">b</span><span class="s2">&quot;a5fa439d-c285-49c1-a39a-af98babd2cbc&quot;</span>
        <span class="p">},</span>
    <span class="p">})</span>

    <span class="n">APP</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The values for ports and secrets are generated by the Kervi commandline tool.
When the Application.run is called the system looks for Kervi components in cam, controllers, dashboard and sensor folders.
In each folder the __init__.py file bootstraps and load the components that resides in the local folder.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dashboards.html" class="btn btn-neutral float-right" title="Dashboards" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getstarted.html" class="btn btn-neutral" title="Get started" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tim Wentzlau.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>