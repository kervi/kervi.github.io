

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overview &mdash; Kervi 0.14.0 - beta documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dashboards" href="dashboards.html" />
    <link rel="prev" title="Get started" href="getstarted.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Kervi
          

          
          </a>

          
            
            
              <div class="version">
                0.14.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Get started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#prerequisites">prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#install">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#create-application">Create application</a><ul>
<li class="toctree-l3"><a class="reference internal" href="getstarted.html#single-file-application">Single file application</a></li>
<li class="toctree-l3"><a class="reference internal" href="getstarted.html#multi-process-file-application">Multi process/file application</a></li>
<li class="toctree-l3"><a class="reference internal" href="getstarted.html#start-application">Start application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#kervi-application-anatomy">Kervi application anatomy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#single-file-application">Single file application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#application-line-1-3">Application (line 1-3)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dashboards-line-5-25">Dashboards (line 5-25)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sensors-26-39">Sensors (26-39)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controllers-line-38-96">Controllers (line 38-96)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linking-controller-inputs-line-100-108">Linking controller inputs (line 100 - 108)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linking-controller-outputs-line-110-113">Linking controller outputs (line 110 - 113)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#go-into-action-line-115">Go into action (line 115)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#multi-file-process-application">Multi file/process application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#distributed-application">Distributed application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboards.html">Dashboards</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dashboards.html#linking">Linking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboards.html#sensors-and-numbers">Sensors and numbers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dashboards.html#controller-pads">Controller pads</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dashboards.html#gpio-and-boolean-values">GPIO and boolean values</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sensors.html">Sensors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sensors.html#kervi-device-library">Kervi Device library</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensors.html#linking-sensors">Linking sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensors.html#implementing-a-sensor-device">Implementing a sensor device</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="controllers.html">Controllers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="controllers.html#input-and-output-interfaces">Input and output interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="controllers.html#linking-controllers">Linking controllers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="signals.html">Signal handling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="signals.html#value-linking">Value linking</a></li>
<li class="toctree-l2"><a class="reference internal" href="signals.html#value-link-transformation">Value link transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="signals.html#dashboard-linking">Dashboard linking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="actions.html">Actions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="actions.html#define-actions">Define actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html#actions-with-timeout">Actions with timeout</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html#asynchronous-action-call">Asynchronous action call</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html#interupts">Interupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html#linking-to-dashboards">Linking to dashboards</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html#system-actions">System actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html#complete-example">Complete example</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html#multiprocess">Multiprocess</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="camera.html">Camera and video</a></li>
<li class="toctree-l1"><a class="reference internal" href="motors.html">Motors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="motors.html#dc-motors">DC motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="motors.html#servo-motor">Servo motor</a></li>
<li class="toctree-l2"><a class="reference internal" href="motors.html#stepper-motors">Stepper motors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuration.html#accessing-config-values-in-code">Accessing config values in code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="security.html#users">Users</a><ul>
<li class="toctree-l3"><a class="reference internal" href="security.html#anonymous-access">Anonymous access</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="security.html#encryption">Encryption</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hal.html">Hardware and devices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hal.html#select-platform">Select platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="hal.html#gpio">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="hal.html#i2c">I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="hal.html#spi">SPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="hal.html#device-library">Device library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ipc.html">Component communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Commandline tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contribute</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contribute.html#development-enviroment">Development enviroment</a></li>
<li class="toctree-l2"><a class="reference internal" href="contribute.html#github-projects">Github projects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contribute.html#application-demo-integration-tests">Application (demo, integration tests)</a></li>
<li class="toctree-l3"><a class="reference internal" href="contribute.html#kervi-core">Kervi core</a></li>
<li class="toctree-l3"><a class="reference internal" href="contribute.html#kervi-platform-driver">Kervi platform driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="contribute.html#kervi-device-library">Kervi device library</a></li>
<li class="toctree-l3"><a class="reference internal" href="contribute.html#kervi-ui-web-dashboards">Kervi UI (Web dashboards)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contribute.html#install-packages">Install packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="contribute.html#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kervi_api.html">Kervi API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dashboards_api.html">Dashboards api</a></li>
<li class="toctree-l2"><a class="reference internal" href="camera_api.html">Camera api</a></li>
<li class="toctree-l2"><a class="reference internal" href="controllers_api.html">Controllers api</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensors_api.html">Sensors API</a></li>
<li class="toctree-l2"><a class="reference internal" href="hal_gpio_api.html">GPIO API</a></li>
<li class="toctree-l2"><a class="reference internal" href="hal_i2c_api.html">I2C API</a></li>
<li class="toctree-l2"><a class="reference internal" href="hal_devices_api.html">Devices API</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Kervi</a>
        
      </nav>


      
      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>If you have completed the steps in the <em>Get started</em> section the result should be a running kervi application.</p>
<div class="section" id="kervi-application-anatomy">
<h2>Kervi application anatomy<a class="headerlink" href="#kervi-application-anatomy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="single-file-application">
<h3>Single file application<a class="headerlink" href="#single-file-application" title="Permalink to this headline">¶</a></h3>
<p>Below you see the content of a <em>single file application</em> that controls the speed of a motor based on the cpu temperature.</p>
<p>myapp.py</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
     <span class="kn">from</span> <span class="nn">kervi.application</span> <span class="kn">import</span> <span class="n">Application</span>
     <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>

     <span class="kn">from</span> <span class="nn">kervi.dashboards.dashboard</span> <span class="kn">import</span> <span class="n">Dashboard</span><span class="p">,</span> <span class="n">DashboardPanel</span>

     <span class="c1">#Define dashboards and panels</span>
     <span class="n">Dashboard</span><span class="p">(</span>
         <span class="s2">&quot;app&quot;</span><span class="p">,</span>
         <span class="s2">&quot;App&quot;</span><span class="p">,</span>
         <span class="p">[</span>
             <span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;fan&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;CPU fan&quot;</span><span class="p">)</span>
         <span class="p">],</span>
         <span class="n">is_default</span><span class="o">=</span><span class="bp">True</span>
     <span class="p">)</span>

     <span class="n">Dashboard</span><span class="p">(</span>
         <span class="s2">&quot;system&quot;</span><span class="p">,</span>
         <span class="s2">&quot;System&quot;</span><span class="p">,</span>
         <span class="p">[</span>
             <span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">),</span>
             <span class="n">DashboardPanel</span><span class="p">(</span><span class="s2">&quot;cam&quot;</span><span class="p">)</span>
         <span class="p">]</span>
     <span class="p">)</span>

     <span class="kn">from</span> <span class="nn">kervi.sensors.sensor</span> <span class="kn">import</span> <span class="n">Sensor</span>
     <span class="kn">from</span> <span class="nn">kervi.devices.platforms.common.sensors.cpu_use</span> <span class="kn">import</span> <span class="n">CPULoadSensorDeviceDriver</span>
     <span class="kn">from</span> <span class="nn">kervi.devices.platforms.common.sensors.cpu_temp</span> <span class="kn">import</span> <span class="n">CPUTempSensorDeviceDriver</span>

     <span class="c1">#build in sensor that measures cpu use</span>
     <span class="n">SENSOR_CPU_LOAD</span> <span class="o">=</span> <span class="n">Sensor</span><span class="p">(</span><span class="s2">&quot;CPULoadSensor&quot;</span><span class="p">,</span> <span class="s2">&quot;CPU&quot;</span><span class="p">,</span> <span class="n">CPULoadSensorDeviceDriver</span><span class="p">())</span>
     <span class="c1">#link to sys area top right</span>
     <span class="n">SENSOR_CPU_LOAD</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;sys-header&quot;</span><span class="p">)</span>
     <span class="c1">#link to a panel, show value in panel header and chart in panel body</span>
     <span class="n">SENSOR_CPU_LOAD</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">link_to_header</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
     <span class="n">SENSOR_CPU_LOAD</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;chart&quot;</span><span class="p">)</span>

     <span class="c1">#build in sensor that measures cpu temperature</span>
     <span class="n">SENSOR_CPU_TEMP</span> <span class="o">=</span> <span class="n">Sensor</span><span class="p">(</span><span class="s2">&quot;CPUTempSensor&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">CPUTempSensorDeviceDriver</span><span class="p">())</span>

     <span class="k">class</span> <span class="nc">FanController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
         <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="n">Controller</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fan_controller&quot;</span><span class="p">,</span> <span class="s2">&quot;Fan&quot;</span><span class="p">)</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;fan&quot;</span>

             <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="n">DynamicNumber</span><span class="p">)</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">150</span>

             <span class="bp">self</span><span class="o">.</span><span class="n">trigger_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;trigger_temp&quot;</span><span class="p">,</span> <span class="s2">&quot;Trigger temperature&quot;</span><span class="p">,</span> <span class="n">DynamicNumber</span><span class="p">)</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">trigger_temp</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">trigger_temp</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">100</span>
             <span class="c1">#remember the value when app restarts</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">trigger_temp</span><span class="o">.</span><span class="n">persist_value</span> <span class="o">=</span> <span class="bp">True</span>

             <span class="bp">self</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;max_temp&quot;</span><span class="p">,</span> <span class="s2">&quot;Max speed temperature&quot;</span><span class="p">,</span> <span class="n">DynamicNumber</span><span class="p">)</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">max_temp</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">max_temp</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">100</span>
             <span class="c1">#remember the value when app restarts</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">max_temp</span><span class="o">.</span><span class="n">persist_value</span> <span class="o">=</span> <span class="bp">True</span>

             <span class="c1">#The only output from this controller is the speed of the fan</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">fan_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;fan_speed&quot;</span><span class="p">,</span> <span class="s2">&quot;Fanspeed&quot;</span><span class="p">,</span> <span class="n">DynamicNumber</span><span class="p">)</span>

             <span class="c1">#private flag that indicate the controller is active and monitors temp and set speed.</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="bp">True</span>

         <span class="c1">#action that starts the active monitoring of the temperature input</span>
         <span class="nd">@action</span>
         <span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="bp">True</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_calc_fan_speed</span><span class="p">()</span>

         <span class="c1">#action interupt call this and the controller stops monitoring the temperature input</span>
         <span class="nd">@active.set_interupt</span>
         <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="bp">False</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_calc_fan_speed</span><span class="p">()</span>

         <span class="k">def</span> <span class="nf">_calc_fan_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">:</span>
                 <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_temp</span><span class="o">.</span><span class="n">value</span>
                 <span class="k">if</span> <span class="n">temp</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">fan_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                 <span class="k">else</span><span class="p">:</span>
                     <span class="n">max_span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_temp</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_temp</span><span class="o">.</span><span class="n">value</span>
                     <span class="n">speed</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">/</span> <span class="n">max_span</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                     <span class="k">if</span> <span class="n">speed</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                         <span class="n">speed</span> <span class="o">=</span> <span class="mi">100</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">fan_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">speed</span>
             <span class="k">else</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">fan_speed</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

         <span class="c1">#called by the framework when a input changes</span>
         <span class="k">def</span> <span class="nf">input_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changed_input</span><span class="p">):</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_calc_fan_speed</span><span class="p">()</span>

     <span class="n">FAN_CONTROLLER</span> <span class="o">=</span> <span class="n">FanController</span><span class="p">()</span>

     <span class="c1">#link the fan controllers temp input to cpu temperature sensor</span>
     <span class="n">FAN_CONTROLLER</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">SENSOR_CPU_TEMP</span><span class="p">)</span>

     <span class="c1">#link the other fan controller inputs to dashboard</span>
     <span class="n">FAN_CONTROLLER</span><span class="o">.</span><span class="n">trigger_temp</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;fan&quot;</span><span class="p">)</span>
     <span class="n">FAN_CONTROLLER</span><span class="o">.</span><span class="n">max_temp</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;fan&quot;</span><span class="p">)</span>

     <span class="c1">#link action to dashboard</span>
     <span class="n">FAN_CONTROLLER</span><span class="o">.</span><span class="n">active</span><span class="o">.</span><span class="n">link_to_dashboard</span><span class="p">(</span><span class="s2">&quot;app&quot;</span><span class="p">,</span> <span class="s2">&quot;fan&quot;</span><span class="p">)</span>

     <span class="c1">#link the fan controller to a DC motor on controlled by a Adafruit motor hat</span>
     <span class="kn">from</span> <span class="nn">kervi_devices.motors.adafruit_i2c_motor_hat</span> <span class="kn">import</span> <span class="n">AdafruitMotorHAT</span>
     <span class="n">MOTOR_CONTROLLER</span> <span class="o">=</span> <span class="n">AdafruitMotorHAT</span><span class="p">()</span>
     <span class="n">MOTOR_CONTROLLER</span><span class="o">.</span><span class="n">dc_motors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">FAN_CONTROLLER</span><span class="o">.</span><span class="n">fan_speed</span><span class="p">)</span>

     <span class="n">APP</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="application-line-1-3">
<h4>Application (line 1-3)<a class="headerlink" href="#application-line-1-3" title="Permalink to this headline">¶</a></h4>
<p>The hart of a kervi application is the Application class.
You must create an Application instance as the very first  operation
in your application.</p>
<p>The Application class prepares your application. It figures out
if you are using a Raspberry Pi as your board and loads required
driveres. It also loads a web server that serves the UI files to the browser.</p>
</div>
<div class="section" id="dashboards-line-5-25">
<h4>Dashboards (line 5-25)<a class="headerlink" href="#dashboards-line-5-25" title="Permalink to this headline">¶</a></h4>
<p>Dashboards are as such not at part of your application logic but you need to
tell kervi how you want to organize your dashboards in the browser.
You can have multiple dashboards in an application. It can be floors in a house
if your are developing a house automation project or it can be a camera view and
system information if you are creating a robot.</p>
<p>In the example above two dashboards are defined: APP and SYSTEM.</p>
<p>Each dashboard has one or more panels where it is possible to link kervi components like sensors and controllers.</p>
</div>
<div class="section" id="sensors-26-39">
<h4>Sensors (26-39)<a class="headerlink" href="#sensors-26-39" title="Permalink to this headline">¶</a></h4>
<p>Sensors are used to sense the world and readings from sensors are handled thru the Sensor Class.
You can program a sensor your self or you can utilize one of the ready made sensor drivers from the Kervi Device Library (KDL).</p>
<p>In the example above a <em>Cpu Load sensor</em> is fetched from KDL and applied to the Sensor class.
When the application is running the Sensor class polls <em>Cpu load sensor</em> device and notify other
parts of the application via events.</p>
<p>In order to display the values from the sensor in the browser you need to link it to a dashboard and a panel.
This is done by calling the method link_to_dashboard where you specify dashboard/panel and display parameters.
When a sensor is linked to a dashboard panel the UI logic will pick up sensor readings for the sensor and update the value on the screen.</p>
</div>
<div class="section" id="controllers-line-38-96">
<h4>Controllers (line 38-96)<a class="headerlink" href="#controllers-line-38-96" title="Permalink to this headline">¶</a></h4>
<p>A controller reacts to one or more inputs and generates one or more outputs.
The input could come from the user via the web based UI, sensors or other application logic.</p>
<p>The example above implements a fan controller that calculates speed of a fan by reading the temperature of a sensor.
The controller only works on its interfaces and is agnostic to how it is linked to user interface and hardware.
In that way it is easy to change hardware and UI without the need for recoding the controller.</p>
<p>In order to do the calculation the controller uses the following inputs:</p>
<ul class="simple">
<li>temp, the temperature that should be used in the calculation.</li>
<li>trigger_temp, if the temperature is below this temperature the fan is stopped.</li>
<li>max_temp, if the temperature is greater that this temperature the fan should run at max speed.</li>
<li>active, if true the controller should calculate the speed. If false the fan should be turned off.</li>
</ul>
<p>In the span from trigger_temp to max_temp the controller will graduatly increase the speed.</p>
<p>In __init__ ( the constructor) you define inputs and outputs.
A controller input is defined by calling self.inputs.add and specify the id, name and type of the input:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="n">NumberValue</span><span class="p">)</span>
</pre></div>
</div>
<p>A controller output is defined by calling self.outputs.add and specify the id, name and type of the output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="n">NumberValue</span><span class="p">)</span>
</pre></div>
</div>
<p>The controller reacts to the input_changed event and calculates the outputs (fan_speed)</p>
</div>
<div class="section" id="linking-controller-inputs-line-100-108">
<h4>Linking controller inputs (line 100 - 108)<a class="headerlink" href="#linking-controller-inputs-line-100-108" title="Permalink to this headline">¶</a></h4>
<p>The next step is to link the controller to the cpu sensor.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">FAN_CONTROLLER</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">SENSOR_CPU_TEMP</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the temp input listen to changes in cpu temperature, when the the temperature changes the input_changed event is fired.</p>
<p>The other controller inputs are linked the dashboard where the user can control these parameters.
When the user changes one of the inputs the input_changed event is fired.</p>
</div>
<div class="section" id="linking-controller-outputs-line-110-113">
<h4>Linking controller outputs (line 110 - 113)<a class="headerlink" href="#linking-controller-outputs-line-110-113" title="Permalink to this headline">¶</a></h4>
<p>In this example the the fan controller is linked to a DC motor that is controlled via a Adafruit motor hat.</p>
<p>The dc motor is linked to fan_speed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MOTOR_CONTROLLER</span><span class="o">.</span><span class="n">dc_motors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">speed</span><span class="o">.</span><span class="n">link_to</span><span class="p">(</span><span class="n">FAN_CONTROLLER</span><span class="o">.</span><span class="n">fan_speed</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the dc motor listen to changes in fan_speed.</p>
</div>
<div class="section" id="go-into-action-line-115">
<h4>Go into action (line 115)<a class="headerlink" href="#go-into-action-line-115" title="Permalink to this headline">¶</a></h4>
<p>The work so far have been to prepare your application to bring it into action you need to call APP.run().
APP.run will start webserver load different modules.
To stop your application you press ctrl + c on the keyboard.</p>
</div>
</div>
<div class="section" id="multi-file-process-application">
<h3>Multi file/process application<a class="headerlink" href="#multi-file-process-application" title="Permalink to this headline">¶</a></h3>
<p>Below is the structure of a multi file Kervi application. All the parts from a single file application are moved into
separate files and folders. Kervi uses this structure to load each section in its own process in order to improve the performance.</p>
<p>A second advantage to this model is that it is easier to maintain the code as the Kervi project grows bigger.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="n">root</span>
<span class="o">|</span>
<span class="o">|-</span> <span class="n">cams</span>
    <span class="o">|-</span> <span class="fm">__init__</span>
    <span class="o">|-</span> <span class="n">cam1</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">controllers</span>
    <span class="o">|-</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">my_controller</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">system_controller</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">dashboards</span>
    <span class="o">|-</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">sensors</span>
    <span class="o">|-</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">my_sensor</span><span class="o">.</span><span class="n">py</span>
    <span class="o">|-</span> <span class="n">system_sensor</span><span class="o">.</span><span class="n">py</span>
<span class="o">|-</span> <span class="n">myapp</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The kervi application is bootstrapped in myapp.py</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">kervi.application</span> <span class="k">import</span> <span class="n">Application</span>
<span class="kn">import</span> <span class="nn">kervi.utility.nethelper</span> <span class="k">as</span> <span class="nn">nethelper</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">APP</span> <span class="o">=</span> <span class="n">Application</span><span class="p">({</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;myapp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;My app&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;modules&quot;</span><span class="p">:[</span><span class="s2">&quot;sensors&quot;</span><span class="p">,</span> <span class="s2">&quot;controllers&quot;</span><span class="p">,</span> <span class="s2">&quot;cams&quot;</span><span class="p">],</span>
    <span class="p">})</span>

    <span class="n">APP</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>When the Application is instantiated it looks for dashboard configuration in the dashboard folder.
The modules specified in the modules parameter are loaded into seperate processes.
In each of the loaded modules the __init__.py file bootstraps and load the
components that resides in the local folder.</p>
</div>
<div class="section" id="distributed-application">
<h3>Distributed application<a class="headerlink" href="#distributed-application" title="Permalink to this headline">¶</a></h3>
<p>It is possible to create a distributed kervi application where multiple computers and controllers Works together.
One computer is the main computer where a kervi application is created.
On the other computers kervi application modules are created that connects to the central kervi application.
The web interface will update it self as modules starts and stops.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dashboards.html" class="btn btn-neutral float-right" title="Dashboards" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getstarted.html" class="btn btn-neutral" title="Get started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Tim Wentzlau.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.14.0 - beta',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>